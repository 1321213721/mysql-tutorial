(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{441:function(s,a,t){s.exports=t.p+"assets/img/image-20200614182205307.8886d953.png"},690:function(s,a,t){"use strict";t.r(a);var e=t(15),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"mysql-参数优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql-参数优化"}},[s._v("#")]),s._v(" MySQL 参数优化")]),s._v(" "),e("h2",{attrs:{id:"优化最大连接数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化最大连接数"}},[s._v("#")]),s._v(" 优化最大连接数")]),s._v(" "),e("p",[e("code",[s._v("max_connections")]),s._v(" 是 MySQL 最大并发连接数，默认值是  151，最大值允许为 16384；")]),s._v(" "),e("p",[s._v("实际连接数设置为：最大连接数的 85% 较为合适")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 目前设置的最大并发连接数量")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'max_connections'")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 目前实际连接数量")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'max_used_connections'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("code",[s._v("/etc/my.cnf")]),s._v(" 中增加 "),e("code",[s._v("max_connections=5000")]),s._v(" ，该配置需要重启数据库")]),s._v(" "),e("p",[s._v("MySQL 为每个链接  "),e("strong",[s._v("创建缓冲区")]),s._v("，所以不应该盲目上调最大连接数。需要考虑你的服务器硬件，如内存是否能支持到这么大的连接数量。")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 比如，在满负荷 3000 并发下，消耗内存为 800M 内存")]),s._v("\nmax_connections"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 那么你就要计算你设置的并发连接数量消耗内存是否内存能装得下")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"优化请求堆栈"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化请求堆栈"}},[s._v("#")]),s._v(" 优化请求堆栈")]),s._v(" "),e("p",[e("code",[s._v("back_log")]),s._v(" 是存放执行请求的堆栈大小，默认值是 50；这个可以理解为队列，当并发连接达到了最大值，剩下的则会放入这个请求堆栈中；")]),s._v(" "),e("h2",{attrs:{id:"修改并发线程数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改并发线程数"}},[s._v("#")]),s._v(" 修改并发线程数")]),s._v(" "),e("p",[e("code",[s._v("innodb_thread_concurrency")]),s._v(" 是并发线程数量，默认是 0，无限制；")]),s._v(" "),e("p",[s._v("这个是多线程的相关的知识了，在CPU 密集型的场景下，设置为何 CPU 核数一样的较佳。")]),s._v(" "),e("p",[s._v("视频中推荐：设置为 CPU 核心数的两倍")]),s._v(" "),e("h2",{attrs:{id:"修改链接超时"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改链接超时"}},[s._v("#")]),s._v(" 修改链接超时")]),s._v(" "),e("p",[e("code",[s._v("wait-timeout")]),s._v(" 超时时间，单位是秒；默认超时时间为 8 小时。")]),s._v(" "),e("p",[s._v("链接长期不用，又不销毁，很是浪费资源")]),s._v(" "),e("h2",{attrs:{id:"innodb-的缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#innodb-的缓存"}},[s._v("#")]),s._v(" InnoDB 的缓存")]),s._v(" "),e("p",[s._v("这里说的不是 "),e("strong",[s._v("查询缓存")]),s._v("，另外查询缓前面说过了，MySQL 8+ 已经去掉了这个功能。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(441),alt:"image-20200614182205307"}})]),s._v(" "),e("p",[s._v("缓存里面保存了两类数据：部分数据和部分索引")]),s._v(" "),e("h2",{attrs:{id:"修改-innodb-缓存大小"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改-innodb-缓存大小"}},[s._v("#")]),s._v(" 修改 InnoDB 缓存大小")]),s._v(" "),e("p",[e("code",[s._v("innodb_buffer_pool_size")]),s._v(" 是 InnoDB 的缓存容量，默认是 128M。")]),s._v(" "),e("p",[s._v("可以设置为主机内存的 "),e("code",[s._v("70%~80%")])]),s._v(" "),e("h2",{attrs:{id:"小结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),e("p",[s._v("数据库参数优化配置有很多，这里只是列出了，可以明显改善数据库性能的参数。")])])}),[],!1,null,null,null);a.default=n.exports}}]);