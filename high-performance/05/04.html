<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>索引案例学习 | MySQL 系列教程（笔记）</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="MySQL 系列教程学习笔记">
    <link rel="preload" href="/mysql-tutorial/assets/css/0.styles.bc63ebf5.css" as="style"><link rel="preload" href="/mysql-tutorial/assets/js/app.7ac7a46f.js" as="script"><link rel="preload" href="/mysql-tutorial/assets/js/2.ea6cbf3c.js" as="script"><link rel="preload" href="/mysql-tutorial/assets/js/73.36783afb.js" as="script"><link rel="preload" href="/mysql-tutorial/assets/js/35.02d8d681.js" as="script"><link rel="prefetch" href="/mysql-tutorial/assets/js/10.eb889e78.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/100.b0d6cb24.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/101.68f256ea.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/102.42508460.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/103.30ab3ade.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/104.02cd592d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/105.a55d0266.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/106.51c1333a.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/107.6ee65580.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/108.3e57bc70.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/109.346ab313.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/11.872c19a6.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/110.8569dd9d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/111.e86e73e3.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/112.2421501e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/113.f02f2692.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/114.0d5c0792.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/115.c28b2655.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/116.0d714f60.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/117.eee09bb4.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/118.0878902d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/119.4a2cb1c8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/12.7b34a2a4.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/120.d0c99b93.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/121.18dae225.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/122.eaa27d9b.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/123.6886eff2.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/124.00c94f88.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/125.05b390aa.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/126.e6f8cb24.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/127.066b8c8e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/128.cd014ece.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/129.cd0d2980.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/13.b36d3865.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/130.4b8f634d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/131.640873ee.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/132.f2f50298.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/133.b2fcecd7.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/134.e3dfa05b.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/135.4d1e6d65.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/136.1f198051.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/137.442b21ff.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/138.7c56c6c4.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/139.88b3947c.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/14.75ec6199.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/140.094f3cc3.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/141.f15bb54e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/142.174b365e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/143.865c5dfe.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/144.7c97ba97.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/15.d58c5f86.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/16.d28c56a9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/17.098395ed.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/18.bc634dc6.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/19.1845bec7.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/20.d107c76b.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/21.0dc7a8b0.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/22.80842d5f.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/23.d720acec.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/24.284e4246.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/25.67c9e135.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/26.b6508801.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/27.84732078.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/28.ad4e2160.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/29.bbfd091e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/3.3eb1b8be.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/30.0ab31ac3.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/31.a7bbc554.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/32.69380177.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/33.364ffb0d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/34.07624a4c.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/36.e98cc8a8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/37.3e6d2bb9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/38.51f7d952.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/39.6657e4df.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/4.b0b44883.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/40.07d8b206.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/41.ec985641.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/42.da65feb7.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/43.330ad3c9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/44.2355b352.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/45.ba08d784.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/46.b78a4275.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/47.c756152f.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/48.c42d9832.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/49.88d244ad.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/5.6e26806a.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/50.1a8b3116.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/51.82b4b7c9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/52.6c7a84fc.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/53.54cfc776.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/54.b88653b2.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/55.8eb80e3d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/56.7097d49c.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/57.f36d4c29.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/58.99256047.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/59.ce9d9bd9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/6.33ab76f3.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/60.94d846d4.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/61.d94b8cf0.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/62.42da86d6.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/63.acf645d3.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/64.04e4e46f.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/65.027d53b0.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/66.7c6a4b84.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/67.4a8e6a48.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/68.2fb45341.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/69.211e34e2.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/7.77e5cd7e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/70.d260b2c6.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/71.c1d449e1.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/72.d8579221.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/74.1153775a.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/75.7178c973.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/76.1e35b783.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/77.2589f8a5.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/78.b0fb34cd.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/79.ef753dea.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/8.ce2e5257.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/80.eaaee2ec.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/81.61ca7dc8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/82.43e64cec.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/83.7696a4c5.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/84.9caf1161.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/85.6fbd6ba8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/86.69a754a8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/87.367c2636.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/88.58f2fc2f.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/89.9d054267.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/9.686bf3d9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/90.81c6e1b0.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/91.85996cd8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/92.879e44f2.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/93.c9244990.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/94.047f2491.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/95.208cbcef.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/96.e82bb3b9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/97.d3f65d2e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/98.581f6d36.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/99.6f9c5b8b.js">
    <link rel="stylesheet" href="/mysql-tutorial/assets/css/0.styles.bc63ebf5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mysql-tutorial/" class="home-link router-link-active"><!----> <span class="site-name">MySQL 系列教程（笔记）</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mysql-tutorial/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="给程序员的 MySQL 8 必知必会" class="dropdown-title"><span class="title">给程序员的 MySQL 8 必知必会</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/" class="nav-link">
  导览
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/01.html" class="nav-link">
  课程序言
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/02/" class="nav-link">
  技术选型之数据库选型
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/03/" class="nav-link">
  数据库设计
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/04/" class="nav-link">
  如何访问 MySQL
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/05/" class="nav-link">
  日常工作 DCL、DDL
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/06/" class="nav-link">
  高阶技能：DML &amp; 常用函数
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/07/" class="nav-link">
  SQL 优化
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/08/" class="nav-link">
  SQL 的索引优化
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/09/" class="nav-link">
  事务与并发控制
</a></li></ul></div></div><div class="nav-item"><a href="/mysql-tutorial/ali-new-retail/" class="nav-link">
  阿里新零售数据库设计与实战
</a></div><div class="nav-item"><a href="/mysql-tutorial/high-performance/" class="nav-link router-link-active">
  高性能 MySQL（第 3 版）
</a></div><div class="nav-item"><a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  笔记精选汇总
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/zq99299/mysql-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mysql-tutorial/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="给程序员的 MySQL 8 必知必会" class="dropdown-title"><span class="title">给程序员的 MySQL 8 必知必会</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/" class="nav-link">
  导览
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/01.html" class="nav-link">
  课程序言
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/02/" class="nav-link">
  技术选型之数据库选型
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/03/" class="nav-link">
  数据库设计
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/04/" class="nav-link">
  如何访问 MySQL
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/05/" class="nav-link">
  日常工作 DCL、DDL
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/06/" class="nav-link">
  高阶技能：DML &amp; 常用函数
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/07/" class="nav-link">
  SQL 优化
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/08/" class="nav-link">
  SQL 的索引优化
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/09/" class="nav-link">
  事务与并发控制
</a></li></ul></div></div><div class="nav-item"><a href="/mysql-tutorial/ali-new-retail/" class="nav-link">
  阿里新零售数据库设计与实战
</a></div><div class="nav-item"><a href="/mysql-tutorial/high-performance/" class="nav-link router-link-active">
  高性能 MySQL（第 3 版）
</a></div><div class="nav-item"><a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  笔记精选汇总
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/zq99299/mysql-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/mysql-tutorial/high-performance/" class="sidebar-link">高性能 MySQL（第三版）</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>01. MySQL 架构与历史</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>02. MySQL 基准测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>03. 服务器性能剖析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>04. Schema 与数据类型优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>05. 创建高性能索引</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql-tutorial/high-performance/05/" class="sidebar-link">创建高性能索引</a></li><li><a href="/mysql-tutorial/high-performance/05/01.html" class="sidebar-link">索引基础</a></li><li><a href="/mysql-tutorial/high-performance/05/02.html" class="sidebar-link">索引的优点</a></li><li><a href="/mysql-tutorial/high-performance/05/03.html" class="sidebar-link">高性能索引策略</a></li><li><a href="/mysql-tutorial/high-performance/05/04.html" class="active sidebar-link">索引案例学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql-tutorial/high-performance/05/04.html#支持多种过滤条件" class="sidebar-link">支持多种过滤条件</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/high-performance/05/04.html#避免多个范围条件" class="sidebar-link">避免多个范围条件</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/high-performance/05/04.html#优化排序" class="sidebar-link">优化排序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql-tutorial/high-performance/05/04.html#延迟关联" class="sidebar-link">延迟关联</a></li></ul></li></ul></li><li><a href="/mysql-tutorial/high-performance/05/05.html" class="sidebar-link">维护索引和表</a></li><li><a href="/mysql-tutorial/high-performance/05/06.html" class="sidebar-link">总结</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>06. 查询性能优化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="索引案例学习"><a href="#索引案例学习" class="header-anchor">#</a> 索引案例学习</h1> <p>理解索引最好的办法是结合示例，这里准备了一个。</p> <p>假设要设计一个在线约会网站，用户信息表有很多列，包括国家、地区、城市、性别、眼睛颜色等等。</p> <ul><li>必须支持上面这些特征的各种组合来搜索用户</li> <li>还必须允许根据用户的最后在线时间、其他会员对用户的评分等对用户进行排序并对结果进行限制</li></ul> <p>如何设计索引满足上面复杂需求呢？</p> <p>第一件需要考虑的事情是：需要使用索引来排序，还是先检索数据再排序。<strong>使用索引排序会严格限制索引和查询的设计</strong>。例如：希望使用索引根据其他会员对用户的评分排序，则 where 条件中的 <code>age between 18 and 25</code> 就无法使用索引。如果 MySQL 使用某个索引进行范围查询，也就无法再使用另一个索引（或则是该索引的后续字段）进行排序了。如果这是很常见的 where 条件，那么我们当然就会认为很多查询需要做排序操作（例如文件排序 filesort）</p> <h2 id="支持多种过滤条件"><a href="#支持多种过滤条件" class="header-anchor">#</a> 支持多种过滤条件</h2> <p>现在需要看看那些列拥有很多不同的取值，哪些列在 where 子句中出现得最频繁。因为可以让 MySQL 更有效的过滤掉不需要的行。</p> <p>country 列的选择性通常不高，但可能很多查询都会用到。sex 列的选择性肯定很低，但也会在很多查询中用到。所以考虑到使用的频率，还是建议在创建不同组合索引的时候将 <code>(sex,country)</code> 列作为前缀。</p> <p>但是根据传统的经验不建议在选着性低的列上创建索引，这里选择了两个选着性很低的字段作为索引的前缀列，原因有两点：</p> <ol><li>几乎所有的查询都会用到 sex 列，甚至会把网站设计成每次都只能按某一种性别搜索用户</li> <li>索引中加上这一列也没有坏处，即使查询没有使用 sex 列，也可以通过下面的诀窍绕过</li></ol> <p>诀窍是：如果某个查询不限制性别 ，那么可以通过在查询条件中 <strong>新增 <code>and sex in('m','f')</code> 来让 MySQL 选择该索引</strong>。如果在某些场景中，列有太多不同的值，就会让 in 列表太长，就不适合这种方法。</p> <p>这个案例显示了一个基本原则：<strong>考虑表上所有的选项</strong>。当设计索引时，不要只为现有的查询考虑需要哪些索引，还需要考虑对查询进行优化。如果发现某些查询需要创建新索引，但是这个索引又会降低另一些查询的效率，那么应该想一下是否能优化原来的查询。<strong>应该同时优化查询和索引找到最佳的平衡</strong>，而不是闭门造车去设计最完美的索引。</p> <p>接下来，需要考虑其他常见 where 条件的组合，并需要了解哪些组合在没有合适索引的情况下回很慢。<code>(sex,country,age)</code> 上的索引就是一个很明显的选择，另外很有可能还需要 <code>(sex,country,region,age)</code> 和 <code>(sex,country,region,city,age)</code> 这样的组合索引。</p> <p>这样就会需要大量的索引。如果想尽可能 <strong>重用索引</strong> 而不是建立大量的组合索引，可以使用前面提到的 <code>in()</code> 技巧来避免同时需要 <code>(sex,country,age)</code> 和 <code>(sex,country,region,age)</code> 的索引。如果没有指定这个字段搜索，就需要定义一个全部国家列表，或则国家全部地区列表，来确保索引前缀有同样的约束（组合所有国家、地区、性别将会是一个非常大的条件）。</p> <p>这些索引将满足大部分最常见的搜索，但是如何为一些生僻的搜索条件（比如 has_pictures、eye_color、hair_color 和 education）来设计索引呢？这些 <strong>列的选择性高、使用也不频繁</strong> 可以选择忽略他们。让 MySQL 多扫描一些额外的行即可。另外一个可选的方法是在 age 列的前面加上这些列，在查询的时候使用 <code>in</code> 来处理。</p> <p>你可能已经注意到，我们一直 <strong>将 age 列放在索引的最后面</strong>，是因为我们总是尽可能让 MySQL 使用更多的索引列，<strong>因为查询只能使用索引的最左前缀</strong>，直到遇到第一个范围条件列。前面提到的列在 where 子句中都是等于条件，但是 age 列多半是范围查询（例如查找年龄在 18~25 岁之间的人）</p> <p>当然，也可以使用 in 来代替范围查询，例如将条件改写为 <code>in(18,19,20,21,22...)</code>，但不是所有的查询都可以转换。这里描述的基本原则是：<strong>尽可能将需要做范围查询的列放到索引的后面</strong>，以便优化器能使用尽可能多的索引列。</p> <p>前面提到可以用 in 的方式覆盖那些不在 where 子句中的列。但是这种技巧不能滥用，否则可能会带来麻烦。因为 <strong>每额外增加一个 in() 条件，优化器需要做的组合都将以指数形式增加</strong>，最终可能会极大的降低查询的性能。考虑下面的 where 子句</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">where</span> eye_color  <span class="token operator">in</span><span class="token punctuation">(</span><span class="token string">'brown'</span><span class="token punctuation">,</span><span class="token string">'blue'</span><span class="token punctuation">,</span><span class="token string">'hazel'</span><span class="token punctuation">)</span>
	<span class="token operator">and</span> hair_color <span class="token operator">in</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">,</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token string">'blonde'</span><span class="token punctuation">,</span><span class="token string">'brown'</span><span class="token punctuation">)</span>
	<span class="token operator">and</span> sex				 <span class="token operator">in</span><span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>优化器则会转化成 <code>4x3x2 =24</code> 种组合，执行计划需要检查 where 子句中偶有的 24 种组合。对于 MySQL 来说 24 种不是很夸张，但如果组合数达上千则需要特别小心。老版本查询优化需要花很多时间，并消耗大量内存。新版本在组合数超过一定数量后就不再执行计划评估了，这 <strong>可能会导致 MySQL 不能很好的利用索引</strong>。</p> <h2 id="避免多个范围条件"><a href="#避免多个范围条件" class="header-anchor">#</a> 避免多个范围条件</h2> <p>假设有一个 last_online 列并希望通过下面的查询显示过期几周上线过的用户</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">where</span> eye_color  <span class="token operator">in</span><span class="token punctuation">(</span><span class="token string">'brown'</span><span class="token punctuation">,</span><span class="token string">'blue'</span><span class="token punctuation">,</span><span class="token string">'hazel'</span><span class="token punctuation">)</span>
	<span class="token operator">and</span> hair_color <span class="token operator">in</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">,</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token string">'blonde'</span><span class="token punctuation">,</span><span class="token string">'brown'</span><span class="token punctuation">)</span>
	<span class="token operator">and</span> sex				 <span class="token operator">in</span><span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">)</span>
	<span class="token operator">and</span> last_online <span class="token operator">&gt;</span> date_sub<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">interval</span> <span class="token number">7</span> <span class="token keyword">day</span><span class="token punctuation">)</span>
	<span class="token operator">and</span> age				 <span class="token operator">between</span> <span class="token number">18</span> <span class="token operator">and</span> <span class="token number">25</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>什么是范围条件？从 explain 的输出很难区分 MySQL 是要查询范围值还是查询列表值。explain 使用同样的词 <code>range</code> 来描述这两种情况。</p> <p><img src="/mysql-tutorial/assets/img/image-20200524223336352.a916667a.png" alt="image-20200524223336352"></p> <p>可以看到从 explain 无法区分这两者的。但是可以从值的范围和多个等于条件来得出不同。在我们看到，第二个查询就是多个等值条件查询。</p> <p><strong>这两种访问效率是不同的</strong>：</p> <ul><li>对于范围条件查询：MySQL 无法再使用范围列后面的其他索引列了</li> <li>对于多个等值条件查询：则没有这个限制</li></ul> <p>这个查询有一个问题：它有两个范围条件，last_online 和 age 列。<strong>MySQL 可以使用其中一个，但无法同时使用</strong>。</p> <p>对于上述两个范围查询没有一个直接的办法能够解决，但是可以 <strong>将其中一个范围查询转换为简单的等值比较</strong>：last_online 列就是需要 7 天内登陆过的，可以新增一个 active 列，该字段有定时任务来维护，当用户每次登陆时，将对应值设置为 1，并且将过去连续 7 天未登陆的用户值设置为 0。</p> <p>这个方法可以让 MySQL 使用 <code>(active,sex,country,age)</code> 索引。active 列并不是完全精确的，但是对于这类查询来说，对精度要求不是那么高。如果需要精确数据，可以把 last_online 列放到 where 子句中，但不加入到索引中。这和前面计算 URL 哈希值来实现 URL 的快速查找类似。</p> <p>到目前为止，我们可以看到：如果用户希望同时看到活跃和不活跃的用户，可以在查询中使用 <code>in()</code> 列表。我们已经加入了很多这样的列表，但另外一个可选的方案就只能是为不同的组合列创建单独的索引。只要需要建立如下的索引：</p> <ul><li><code>(active,sex,country,age)</code></li> <li><code>(active,country,age)</code></li> <li><code>(sex,country,age)</code></li> <li><code>(country,age)</code></li></ul> <p>这些索引对某个具体的查询来说可能都是更优化的，但是考虑到索引的维护和额外的空间占用的代价，这个可选方案就不是一个好策略了。</p> <p>在这个案例中，<strong>优化器的特性是影响索引策略的一个很重要的因素</strong>。如果未来版本的 MySQL 能够实现松散索引扫描，就能在一个索引上使用多个范围条件，那也就不需要为上面考虑这类查询使用 <code>int()</code> 列表了。</p> <h2 id="优化排序"><a href="#优化排序" class="header-anchor">#</a> 优化排序</h2> <p>使用文件排序对数据集是很快的，但如果一个查询匹配的结果有上百万行的话会怎样？例如如果 where 子句只有 sex 列，如何排序？</p> <p>对于 <strong>那些选择性非常低的列，可以增加一些特殊的索引来做排序</strong>。例如：可以创建 <code>(sex,rating)</code> 索引用于下面的查询：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">&lt;</span>cols<span class="token operator">&gt;</span> <span class="token keyword">from</span> profiles <span class="token keyword">where</span> sex<span class="token operator">=</span><span class="token string">'M'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> rating <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个查询同时使用了 order by 和 limit，如果没有索引的话会很慢。</p> <p>即使有索引，如果用户界面上需要翻页，并且翻页到比较靠后时查询也可能非常慢。下面这个查询就通过 order by 和 limit 偏移量的组合翻页到很后面的时候</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">&lt;</span>cols<span class="token operator">&gt;</span> <span class="token keyword">from</span> profiles <span class="token keyword">where</span> sex<span class="token operator">=</span><span class="token string">'M'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> rating <span class="token keyword">limit</span> <span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>无论如何创建索引，这种查询都是个严重的问题</strong>。因为：随着偏移量的增加，MySQL <strong>需要花费大量的时间来扫描需要丢弃的数据</strong>。反范式化、预先计算和缓存可能是解决这类查询的 <strong>仅有策略</strong>。一个更好的办法是限制用户能够翻页的数量，实际上这对用户体验影响不大，因为很少有用户会在乎搜索结果的第 10 万页。</p> <h3 id="延迟关联"><a href="#延迟关联" class="header-anchor">#</a> 延迟关联</h3> <p>优化这类索引的另一个比较好的策略是使用 <strong>延迟关联</strong>：</p> <ol><li>通过使用覆盖索引查询返回需要的主键</li> <li>再跟进这些主键关联原表获得需要的行</li></ol> <p>这可以减少 MySQL 扫描那些需要丢弃的行数。下面这个查询显示了如何高效使用 <code>(sex,rating)</code> 索引进行排序和分页：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">&lt;</span>cols<span class="token operator">&gt;</span> <span class="token keyword">from</span> profiles <span class="token keyword">inner</span> <span class="token keyword">join</span><span class="token punctuation">(</span>
	<span class="token keyword">select</span> <span class="token operator">&lt;</span><span class="token keyword">primary</span> <span class="token keyword">key</span> cols<span class="token operator">&gt;</span> <span class="token keyword">from</span> profiles
  <span class="token keyword">where</span> x<span class="token punctuation">.</span>sex<span class="token operator">=</span><span class="token string">'M'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> rating <span class="token keyword">limit</span> <span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">10</span>
<span class="token punctuation">)</span><span class="token keyword">as</span> x <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">primary</span> <span class="token keyword">key</span> cols<span class="token operator">&gt;</span><span class="token punctuation">)</span>

<span class="token comment">-- using 和 on 类似，只是使用两个列名相同的进行关联</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这里的延迟关联为什么能解决减少需要丢弃的行？（前面有一个专门利用 <a href="/mysql-tutorial/high-performance/05/03.html#覆盖索引好处">覆盖索引使用解延迟关联</a> 的小节）。 这里利用了 <strong>覆盖索引，不用回表</strong>，性能高了很多，只返回了 10 条数据的 ID，再回表去查询数据。就快了很多了</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zq99299/mysql-tutorial/edit/master/docs/high-performance/05/04.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: :</span> <span class="time">a month ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mysql-tutorial/high-performance/05/03.html" class="prev">
        高性能索引策略
      </a></span> <span class="next"><a href="/mysql-tutorial/high-performance/05/05.html">
        维护索引和表
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/mysql-tutorial/assets/js/app.7ac7a46f.js" defer></script><script src="/mysql-tutorial/assets/js/2.ea6cbf3c.js" defer></script><script src="/mysql-tutorial/assets/js/73.36783afb.js" defer></script><script src="/mysql-tutorial/assets/js/35.02d8d681.js" defer></script>
  </body>
</html>
