(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{582:function(t,s,a){"use strict";a.r(s);var e=a(15),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"sql-高级特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql-高级特性"}},[t._v("#")]),t._v(" SQL 高级特性")]),t._v(" "),a("h2",{attrs:{id:"公用表表达式：cte（with）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公用表表达式：cte（with）"}},[t._v("#")]),t._v(" 公用表表达式：CTE（WITH）")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/with.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("前面说到过子查询，但是没有仔细说，是因为出现了更好的替代方式，就是 "),a("strong",[t._v("公用表表达式 CTE（Common Table Expressions）")]),t._v("，")]),t._v(" "),a("ul",[a("li",[t._v("MySQL 8.0 之后版本可用")]),t._v(" "),a("li",[t._v("CTE 生成一个命名临时表，并且只在查询期间有效")]),t._v(" "),a("li",[t._v("与子查询的区别：CTE 临时表在一个查询中可以多次引用及自引用")])]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RECURSIVE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        cte_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("col_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" col_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("subquery"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cte_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("col_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" col_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("subquery"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" cte_name\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" cte "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("col1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" col2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 这里给列取名")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 这里组装了一个临时表一共两列")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" col1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" col2 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" cte"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 下面用 select 语句从 cte 里面查询数据")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  col1\tcol2\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[t._v("使用课程数据来练习")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" cte "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询学习人数大于 2000 人")]),t._v("\n\ttitle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tstudy_cnt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tclass_id \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("\n\timc_course \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("\n\tstudy_cnt "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" cte\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 它可以被多次引用，这里再次使用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" cte\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" title "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 为了看着方便，按 title 排序就会出现两条一模一样的数据")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  title\tstudy_cnt\tclass_id\n  MySQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("04045")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6646")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  MySQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("04045")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6646")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br")])]),a("h3",{attrs:{id:"用-cte-递归生成序列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用-cte-递归生成序列"}},[t._v("#")]),t._v(" 用 CTE 递归生成序列")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" RECURSIVE test "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 使用 RECURSIVE 声明可以递归调用自己")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" n\t\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" test    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 这里引用了自身")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 当 n 大于 10 就退出递归调用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" test\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \n  n\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])]),a("p",[t._v("这个递归，不太好想明白逻辑")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 递归查询课程评论信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 01. 先查看评论表的数据结构")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" imc_question "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" replyid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \n  quest_id\tuser_id\tcourse_id\tchapter_id\tsub_id\treplyid\tquest_title\tquest_content\tquest_type\tview_cnt\tadd_time\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2111")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3080")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("55")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("387")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("788")]),t._v("\t用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3080")]),t._v("对于 用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1217")]),t._v("关于 PostgreSQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("42349")]),t._v("第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("章第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("节的评论的\t用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3080")]),t._v("对于 用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1217")]),t._v("关于 PostgreSQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("42349")]),t._v("第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("章第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("节的评论的回复\t评论\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("47")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("44")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2112")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("695")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5105")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("873")]),t._v("\t用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v("对于 用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2755")]),t._v("关于 MySQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21930")]),t._v("第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("章第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("节的评论的回复\t用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v("对于 用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2755")]),t._v("关于 MySQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21930")]),t._v("第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("章第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("节的评论的回复\t评论\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("44")]),t._v("\n \n可以看到 quest_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2111")]),t._v(" 是对 replyid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("788")]),t._v(" 的一个回复\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 要安装树形结构查询出数据")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 02. 先找到这门课程的所有的问题")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("\n\timc_question \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("\n\tcourse_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),t._v(" \n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" replyid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 回复 ID 等于 0 的，说明是一个问题")]),t._v("\n\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 03. 最终语句")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" RECURSIVE replay "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" quest_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" quest_title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" replyid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询出所有的问答，没有回复的")]),t._v("\n\tquest_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tquest_title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tuser_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\treplyid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tcast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" quest_id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHAR")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" path \n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("\n\t\timc_question \n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("\n\t\tcourse_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),t._v(" \n\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" replyid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 下面开始递归查找他们的评论")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("\n\t\ta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("quest_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\ta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("quest_title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\ta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\ta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replyid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tCONCAT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("' >> '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("quest_id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" path \n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("\n\t\timc_question a "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- a 表的数据是 b 表的回复")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" replay b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replyid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("quest_id \n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("\n\treplay\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 可以看到：path 字段，表示了一个层级了\nquest_id\tquest_title\tuser_id\treplyid\tpath\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1866")]),t._v("\t用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3002")]),t._v("关于 MySQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98454")]),t._v("第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("章第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("节的评论\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3002")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1866")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1888")]),t._v("\t用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("324")]),t._v("关于 MySQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98454")]),t._v("第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v("章第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("节的问答\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("324")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1888")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2246")]),t._v("\t用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2991")]),t._v("对于 用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("324")]),t._v("关于 MySQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98454")]),t._v("第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("章第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("节的问答的回复\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2991")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1471")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1471")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2246")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2257")]),t._v("\t用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2832")]),t._v("对于 用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2214")]),t._v("关于 MySQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98454")]),t._v("第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("章第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("节的问答的回复\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2832")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1379")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1379")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2257")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2320")]),t._v("\t用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2476")]),t._v("对于 用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2832")]),t._v("对于 用户:"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2214")]),t._v("关于 MySQL课程"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98454")]),t._v("第 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("章第 \t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2476")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2257")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1379")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2257")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2320")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br"),a("span",{staticClass:"line-number"},[t._v("50")]),a("br"),a("span",{staticClass:"line-number"},[t._v("51")]),a("br"),a("span",{staticClass:"line-number"},[t._v("52")]),a("br"),a("span",{staticClass:"line-number"},[t._v("53")]),a("br"),a("span",{staticClass:"line-number"},[t._v("54")]),a("br"),a("span",{staticClass:"line-number"},[t._v("55")]),a("br"),a("span",{staticClass:"line-number"},[t._v("56")]),a("br"),a("span",{staticClass:"line-number"},[t._v("57")]),a("br"),a("span",{staticClass:"line-number"},[t._v("58")]),a("br"),a("span",{staticClass:"line-number"},[t._v("59")]),a("br")])]),a("h2",{attrs:{id:"窗口函数：window-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#窗口函数：window-function"}},[t._v("#")]),t._v(" 窗口函数：window function")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/window-functions.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("一组记录，符合记录的每一条记录都会执行这个函数，不会改变记录的函数。")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 窗口函数的基本语法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("exp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("OVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 指定了窗口的范围")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PARTITION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" exp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 把查询的结果集分成大小不同的分组")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" exp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ASC")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DESC")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 按照哪些字段排序，按照排序后的记录进行编号")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("官网文档对于这一章节的描述花费了好几篇的介绍，挺复杂的，先跟着视频中的思路走下去；")]),t._v(" "),a("h3",{attrs:{id:"排名函数：rank、dense-rank"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#排名函数：rank、dense-rank"}},[t._v("#")]),t._v(" 排名函数：RANK、DENSE_RANK")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("聚合函数：比如 avg、count 等函数都可以作为窗口函数使用")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("ROW_NUMBER（）")]),t._v("：返回窗口分区内数据的行号")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("RANK()")]),t._v("：类似与 row_number ，只是对于相同数据会产生重复的行号，之后的数据行号会产生间隔")]),t._v(" "),a("p",[t._v("比如：两个数据并列第一，那么下一个数据的行号为 3")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("DENSE_RANK（）")]),t._v("：类似于 rank ，区别在于当组内某行数据重复时，虽然行号会重复，但后续的行号不会产生间隔")]),t._v(" "),a("p",[t._v("比如：两个数据并列第一，那么下一个数据的行号为 2")])])]),t._v(" "),a("p",[t._v("下面使用一个例子来查看 row_number、rank、dense_rank  的区别")]),t._v(" "),a("h4",{attrs:{id:"范例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范例"}},[t._v("#")]),t._v(" 范例")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 使用 cte 定义一张临时表出来")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("study_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("class_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("score"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sqlercn'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MySQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tom'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MySQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Jerry'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MySQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Gavin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MySQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sqlercn'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PostGreSQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tom'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PostGreSQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Jerry'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PostGreSQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" test\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("p",[t._v("定义出来的临时表就是学生的学习课程分表数据，执行结果如下")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("study_name")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("class_name")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("score")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("sqlercn")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("95")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("tom")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("99")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Jerry")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("99")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Gavin")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("98")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("sqlercn")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostGreSQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("99")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("tom")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostGreSQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("99")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Jerry")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostGreSQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("98")])])])]),t._v(" "),a("p",[t._v("下面使用  row_number、rank、dense_rank 查询数据，然后看他们的不同")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("study_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" class_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" score"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sqlercn'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MySQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tom'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MySQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Jerry'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MySQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Gavin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MySQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sqlercn'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PostGreSQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tom'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PostGreSQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Jerry'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PostGreSQL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" study_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       class_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       score"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       row_number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" class_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" score "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" rw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       rank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" class_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" score "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" rk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       dense_rank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" class_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" score "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" dr\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" test\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" class_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rw\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 上面三个窗口函数都使用 class_name 来分组，并按照 score 进行降序")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br")])]),a("p",[t._v("查询结果如下")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("study_name")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("class_name")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("score")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("rw")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("rk")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("dr")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("tom")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("99")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Jerry")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("99")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Gavin")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("98")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("sqlercn")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("95")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("4")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("4")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("sqlercn")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostGreSQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("99")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("tom")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostGreSQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("99")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Jerry")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostGreSQL")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("98")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2")])])])]),t._v(" "),a("p",[t._v("首先上面查询语句的窗口函数功能都是先按照课程名称进行分组，然后在组中按分数进行降序。下面一个一个解说：")]),t._v(" "),a("ul",[a("li",[t._v("rw：tom 和 Jerry 的分数都是 99，但是它的行号都是按照顺序排列的")]),t._v(" "),a("li",[t._v("rk：tom 和 Jerry 的分数都是 99，他们并列第一，下一个行号中断了，从 3 开始")]),t._v(" "),a("li",[t._v("dr：tom 和 Jerry 的分数都是 99，他们并列第一，下一个行号没有中断，从 2 开始")])]),t._v(" "),a("h4",{attrs:{id:"业务练习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#业务练习"}},[t._v("#")]),t._v(" 业务练习")]),t._v(" "),a("p",[t._v("**范例 1：**按学习人数对课程进行排名，并列出每类课程学习人数排名前 3 的课程名称，显示学习人数以及名次")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 先查询出按学习人数对课程进行排名的课程")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" ic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("study_cnt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       rank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" class_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" study_cnt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" rk\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" imc_course a\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" imc_class ic "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("结果如下，下面是一部分数据")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("class_name")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("title")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("study_cnt")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("rk")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-33460")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("9588")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-90092")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6818")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-41163")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6252")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-60895")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("4585")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("4")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL课程-57732")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3562")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("5")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-85484")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3104")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-55484")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("551")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("7")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-27822")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("192")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("8")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("HadoopDock")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-09426")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6529")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("HadoopDock")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-71352")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6100")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("HadoopDock")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-00924")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3819")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3")])])])]),t._v(" "),a("p",[t._v("可以看到 Docker 分类就有 8 个课程，我们要求是只要每类课程排名前 3 的课程")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" tmp "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" ic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n           a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n           a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("study_cnt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n           rank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" class_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" study_cnt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),t._v("\n               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" rk\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" imc_course a\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" imc_class ic "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id\n  \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 在这里无法使用 where rk  <= 3，语法错误")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" tmp\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" rk "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 需要使用公共表达式搞成一个临时表")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[t._v("输出结果如下")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("class_name")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("title")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("study_cnt")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("rk")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-33460")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("9588")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-90092")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6818")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-41163")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6252")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("HadoopDock")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-09426")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6529")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("HadoopDock")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-71352")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6100")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("HadoopDock")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-00924")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3819")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3")])])])]),t._v(" "),a("p",[t._v("**范例 2：**每门课程的学习热数占本类课程总学习人数的百分比")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" tmp "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 再次提示，这里出来的 class_total 不能直接使用，转成公共表")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" class_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" study_cnt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("study_cnt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("over")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" class_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" calss_total\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" imc_course ic\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" imc_class i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" ic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("class_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" concat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("study_cnt "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" calss_total "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" percentage\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" tmp\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 以上关联 class 表是为了获取它的名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 重点是 sum 与 over 一起使用， over 分组，然后 sum 统计该分组")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("数据如下")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("class_name")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("title")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("study_cnt")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("calss_total")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("percentage")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-85484")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3104")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("34652")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("8.9576%")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-33460")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("9588")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("34652")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("27.6694%")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-41163")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6252")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("34652")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("18.0422%")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-55484")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("551")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("34652")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1.5901%")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-60895")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("4585")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("34652")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("13.2316%")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-27822")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("192")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("34652")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("0.5541%")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL课程-57732")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3562")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("34652")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("10.2793%")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Docker")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-90092")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6818")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("34652")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("19.6756%")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("HadoopDock")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PostgreSQL课程-00924")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3819")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("21755")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("17.5546%")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("HadoopDock")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-63911")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1498")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("21755")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6.8858%")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("HadoopDock")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SQLServer课程-52859")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3513")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("21755")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("16.1480%")])])])]),t._v(" "),a("p",[t._v("可以看到，每一条数据上都会出现分组统计的总数量，相同分类的数量还都是一致的。再以公共表为基础进行除法运算")])])}),[],!1,null,null,null);s.default=n.exports}}]);