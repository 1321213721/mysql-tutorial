(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{430:function(s,a,t){s.exports=t.p+"assets/img/image-20200611224913567.8cba2d8f.png"},676:function(s,a,t){"use strict";t.r(a);var n=t(15),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"如何抵御-xss-攻击"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何抵御-xss-攻击"}},[s._v("#")]),s._v(" 如何抵御 XSS 攻击")]),s._v(" "),n("h2",{attrs:{id:"什么是-xss-攻击？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-xss-攻击？"}},[s._v("#")]),s._v(" 什么是 XSS 攻击？")]),s._v(" "),n("p",[s._v("XSS 是跨站脚本攻击，让浏览器渲染 DOM 的时候意外的执行了恶意 JS 代码。")]),s._v(" "),n("p",[s._v("XSS 攻击的原理是：在网页中嵌入一个恶意脚本。")]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[s._v("<img src=\"null\" onerror='alert(document.cookie)'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("如上代码，在宝贝详情里面添加了 img 标签， 由于 src 是 null，加载图片出错，就会触发 onerror 事件，就把你的 cookie 弹出来了。这只是一个抛砖引玉，可以利用类似的手段执行其他的代码。")]),s._v(" "),n("p",[s._v("如下图：在内容里面写入这个恶意代码，你的网页在渲染这个内容的时候，直接用 html 模式渲染，就导致了恶意代码的执行")]),s._v(" "),n("p",[n("img",{attrs:{src:t(430),alt:"image-20200611224913567"}})]),s._v(" "),n("h2",{attrs:{id:"xss-的危险之处"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#xss-的危险之处"}},[s._v("#")]),s._v(" XSS 的危险之处")]),s._v(" "),n("p",[s._v("浏览器是一个沙箱环境，JavaScript 不可以读写本地文件、不可以连接数据库、不可以创建线程。")]),s._v(" "),n("p",[s._v("但是有一些技术绕过这个机制，如 flash、java applet 程序。")]),s._v(" "),n("p",[n("strong",[s._v("XSS 不会对系统造成破坏，但是却可以盗用账户信息")])]),s._v(" "),n("h2",{attrs:{id:"html-格式邮件-xss-攻击"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#html-格式邮件-xss-攻击"}},[s._v("#")]),s._v(" HTML 格式邮件 XSS 攻击")]),s._v(" "),n("p",[s._v("通过邮箱发送 HTML 格式的邮件，你打开之后，就有可能执行恶意代码了。")]),s._v(" "),n("p",[s._v("这种类型的只有靠邮箱运营商来过滤这种恶意脚本了。")]),s._v(" "),n("h2",{attrs:{id:"内容转义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内容转义"}},[s._v("#")]),s._v(" 内容转义")]),s._v(" "),n("p",[s._v("那么怎么对要保存在数据库的数据进行恶意脚本过滤？")]),s._v(" "),n("p",[s._v("这里可以使用 "),n("strong",[s._v("AntiSamy")]),s._v(" 这个开源的 Java 库，可以用来过滤 XSS 恶意代码")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("compile group: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'org.owasp.antisamy'")]),s._v(", name: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'antisamy'")]),s._v(", version: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.5.9'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("owasp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("validator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AntisamyTest")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PolicyException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ScanException")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" temp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"你好，这个是一个破坏代码<img src='null' onerror='alert(123456)'>\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AntisamyTest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/antisamy.xml"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Policy")]),s._v(" policy "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Policy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AntiSamy")]),s._v(" samy "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AntiSamy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CleanResults")]),s._v(" scan "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" samy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("scan")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("temp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" policy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scan"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCleanHTML")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n# 输出结果为 \n你好，这个是一个破坏代码"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img src"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"null"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("对于 antisamy.xml 是 antisamy 的一个策略配置文件，自带的 jar 包中，已经包含了好几个规则，有宽松的，有严格的（可以吧 img 标签都删除）。")]),s._v(" "),n("h2",{attrs:{id:"本章要点回顾"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本章要点回顾"}},[s._v("#")]),s._v(" 本章要点回顾")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("电商系统，秒杀的时候如何避免商品超售？")]),s._v(" "),n("p",[s._v("数据库使用乐观锁，使用 Redis 的事务机制。")])]),s._v(" "),n("li",[n("p",[s._v("为什么不用存储过程？")]),s._v(" "),n("p",[s._v("不适合集群场景。")])]),s._v(" "),n("li",[n("p",[s._v("如何预防电商交易中，卖家偷换商品信息？")]),s._v(" "),n("p",[s._v("商品信息修改要备份。相当于做快照")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);