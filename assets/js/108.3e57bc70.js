(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{619:function(s,a,t){"use strict";t.r(a);var e=t(15),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"基准测试工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基准测试工具"}},[s._v("#")]),s._v(" 基准测试工具")]),s._v(" "),t("p",[s._v("没有必要开发资金的基准测试系统，除非现有的工具确实无法满足需求。下面介绍一些可用的工具")]),s._v(" "),t("h2",{attrs:{id:"集成式测试工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集成式测试工具"}},[s._v("#")]),s._v(" 集成式测试工具")]),s._v(" "),t("p",[s._v("已有额集成测试式工具有：")]),s._v(" "),t("h3",{attrs:{id:"ab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ab"}},[s._v("#")]),s._v(" ab")]),s._v(" "),t("p",[s._v("ab 是 Apache HTTP 服务器基准测试工具。可用测试 HTTP 服务器每秒最多可以处理多少请求。如果测试的是 web 应用服务，这个结果可以转换成整个应用每秒可以满足多少请求。")]),s._v(" "),t("p",[s._v("是个非常简单的工具，用途也有限，只能针对单个 URL 进行尽可能的压力测试。")]),s._v(" "),t("h3",{attrs:{id:"http-load"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-load"}},[s._v("#")]),s._v(" http_load")]),s._v(" "),t("p",[s._v("概念上和 ab 类似，也被设计为对 web 服务器进行测试，比 ab 要更加灵活，可以通过一个输入文件提供多个 URL。它会在这些 URL 中随机选择进行测试。也可以定制 http_load，使其按照时间比率进行测试，而不仅仅是测试最大请求处理能力")]),s._v(" "),t("h3",{attrs:{id:"jmeter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jmeter"}},[s._v("#")]),s._v(" JMeter")]),s._v(" "),t("p",[s._v("是一个 Java 应用恒旭，可以加载其他应用并测试其性能。虽然是用来测试 web 应用的，但也可以用于测试诸如 FTP 服务器，或则通过 JDBC 进行数据库查询测试。")]),s._v(" "),t("p",[s._v("它比 ab 或 http_load 要复杂得多。例如：")]),s._v(" "),t("ul",[t("li",[s._v("它可以通过控制预热时间等参数，更加灵活的模拟真实用户的访问。")]),s._v(" "),t("li",[s._v("有绘图接口（带内置的图形化处理的功能）")]),s._v(" "),t("li",[s._v("可以对测试进行记录，然后离线重演测试结果")])]),s._v(" "),t("h2",{attrs:{id:"单组件测试工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单组件测试工具"}},[s._v("#")]),s._v(" 单组件测试工具")]),s._v(" "),t("p",[s._v("有一些有用的工具可以测试 MySQL 和基于 MySQL 的系统性能。后续介绍如何利用这些工具进行测试")]),s._v(" "),t("h3",{attrs:{id:"mysqlslap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysqlslap"}},[s._v("#")]),s._v(" mysqlslap")]),s._v(" "),t("p",[s._v("mysqlslap 可以模拟服务器的负载，并输出计时信息。它包含在 MySQL 5.1 的发型包中。测试时可以执行并发连接数，并指定 SQL 语句（可以在命令行上执行，也可以把 SQL 语句写入到参数文件中）。如果没有指定 SQL 语句，它会自动生成查询 schema 的 SELECT 语句")]),s._v(" "),t("h3",{attrs:{id:"mysql-benchmark-suite（sql-bench）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-benchmark-suite（sql-bench）"}},[s._v("#")]),s._v(" MySQL Benchmark Suite（sql-bench）")]),s._v(" "),t("p",[s._v("在 MySQL 的发行包中也提供了一款自己的基准测试套件，可以用于在不同数据库服务器上进行比较屙屎。它是单线程的，主要用于测试服务器执行查询的速度。结果会显示那种类的操作在服务器上执行得更快")]),s._v(" "),t("p",[s._v("该测试套件的主要好处是包含了大量预定义的测试，容易使用，所以可以很轻松的用于比较不同存储引擎或则不同配置的性能测试。也可应用于高层次测试，比较两个服务器的总体性能。当然也可以只执行预定义的测试子集（例如只测试 UPDATE 的性能）。这些测试大部分是 CPU 密集型的，但也有短时间的测试需要大量的磁盘 I/O 操作")]),s._v(" "),t("p",[s._v("该套件最大的缺点主要有：单用户模式，测试的数据集很小且用户无法使用指定的数据，并且同一个测试多次运行的结果可能会相差很大。因为是单线程且串行执行的，所以无法测试多 CPU 的能力，只能用于比较单 CPU 服务器的性能差别。使用该套件测试数据库服务器还需要 Perl 和 BDB 的支持")]),s._v(" "),t("h3",{attrs:{id:"super-smack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#super-smack"}},[s._v("#")]),s._v(" Super Smack")]),s._v(" "),t("p",[s._v("是一款用于 MySQL 和 PostgrSQL 的基准测试工具，可以提供压力测试和负载生成。这是一个复杂而强大的工具，可以模拟多用户访问，可以加载测试数据到数据库，并支持使用随机数据填充测试表。测试定义在 「smack」文件中，smack 文件使用一种简单的语法定义测试的客户端、表、查询等测试要素")]),s._v(" "),t("h3",{attrs:{id:"database-test-suite"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#database-test-suite"}},[s._v("#")]),s._v(" Database Test Suite")]),s._v(" "),t("p",[s._v("是由开源软壳开发实验室设计的，发布在 SourceForge 网站上，是一款类似某些工业标准测试的测试工具集，例如由事物处理性能委员会（TPC）制定的各种标准。特别值得一提的是，其中的 dbt2 就是一款免费的 TPC-C OLTP 策测试工具。之前本书作作者经常使用该工具，不过现在已经使用自己研发的专用于 MySQL 的测试工具替代了")]),s._v(" "),t("h3",{attrs:{id:"perconas-tpcc-mysql-tool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#perconas-tpcc-mysql-tool"}},[s._v("#")]),s._v(" Perconas TPCC-MySQL Tool")]),s._v(" "),t("p",[s._v("类似 TPC-C 的基准测试工具集，其中有部分是专门为 MySQl 测试开放的。在评估大鸭梨下 MySQL 的一些行为时，经常会利用这个工具进行测试（简单的测试，一般会采用 sysbench 替代）")]),s._v(" "),t("h3",{attrs:{id:"sysbench"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sysbench"}},[s._v("#")]),s._v(" sysbench")]),s._v(" "),t("p",[s._v("是一款多线程系统压测工具。可以根据影响数据库服务器性能的各种因素来评估系统的性能。")]),s._v(" "),t("p",[s._v("例如，可以用来测试文件 I/O、操作系统调度器、内存分配和传输速度、POSIX 线程，以及数据库服务器等。支持 Lua 脚本语言，Lua 对于各种测试场景的设置可以非常灵活。")]),s._v(" "),t("p",[s._v("sysbench 是我们非常喜欢的一种全能测试工具，支持 MySQL、操作系统和硬件的硬件测试。")]),s._v(" "),t("h3",{attrs:{id:"mysql-的-benchmark-函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-的-benchmark-函数"}},[s._v("#")]),s._v(" MySQL 的 "),t("code",[s._v("BENCHMARK()")]),s._v("函数")]),s._v(" "),t("p",[s._v("MySQL 有一个内置的 "),t("code",[s._v("BENCHMARK()")]),s._v(" 函数，可以测试某些特定操作的执行速度。参数可以是需要执行的次数和表达式。表达式可以是任何的标量表达式，比如返回值是标量的子查询或则函数。该函数可以很方便的测试某些特定操作的性能，比如通过测试可以发现 "),t("code",[s._v("MD5()")]),s._v(" 函数比 "),t("code",[s._v("SHA1()")]),s._v(" 函数要快")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@input")]),s._v(" :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello world'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 输出都是 0.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" BENCHMARK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MD5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@input")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.78")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" BENCHMARK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SHA1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@input")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.50")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("执行返回值永远是 0，可以通过客户端返回的时间来判断执行的时间。要清楚原理，否则容易误用。")]),s._v(" "),t("p",[s._v("该函数只是简单的返回服务器执行表达式的时间，而不会涉及分析和优化的开销。而且表达式必须像这个列子一样包含用户定义的变量，否则多次执行同样的表达式会因为系统缓存命中而影响结果。")]),s._v(" "),t("p",[s._v("它不适合用来做真正的基准测试，因为很难理解真正要测试的是什么，而且测试的只是整个执行周期中的一部分环节。")])])}),[],!1,null,null,null);a.default=r.exports}}]);