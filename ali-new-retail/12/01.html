<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MyCat 双机热备方案 | MySQL 系列教程（笔记）</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="MySQL 系列教程学习笔记">
    <link rel="preload" href="/mysql-tutorial/assets/css/0.styles.bc63ebf5.css" as="style"><link rel="preload" href="/mysql-tutorial/assets/js/app.7ac7a46f.js" as="script"><link rel="preload" href="/mysql-tutorial/assets/js/2.ea6cbf3c.js" as="script"><link rel="preload" href="/mysql-tutorial/assets/js/34.07624a4c.js" as="script"><link rel="preload" href="/mysql-tutorial/assets/js/35.02d8d681.js" as="script"><link rel="prefetch" href="/mysql-tutorial/assets/js/10.eb889e78.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/100.b0d6cb24.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/101.68f256ea.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/102.42508460.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/103.30ab3ade.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/104.02cd592d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/105.a55d0266.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/106.51c1333a.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/107.6ee65580.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/108.3e57bc70.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/109.346ab313.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/11.872c19a6.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/110.8569dd9d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/111.e86e73e3.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/112.2421501e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/113.f02f2692.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/114.0d5c0792.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/115.c28b2655.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/116.0d714f60.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/117.eee09bb4.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/118.0878902d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/119.4a2cb1c8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/12.7b34a2a4.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/120.d0c99b93.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/121.18dae225.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/122.eaa27d9b.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/123.6886eff2.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/124.00c94f88.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/125.05b390aa.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/126.e6f8cb24.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/127.066b8c8e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/128.cd014ece.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/129.cd0d2980.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/13.b36d3865.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/130.4b8f634d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/131.640873ee.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/132.f2f50298.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/133.b2fcecd7.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/134.e3dfa05b.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/135.4d1e6d65.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/136.1f198051.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/137.442b21ff.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/138.7c56c6c4.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/139.88b3947c.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/14.75ec6199.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/140.094f3cc3.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/141.f15bb54e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/142.174b365e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/143.865c5dfe.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/144.7c97ba97.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/15.d58c5f86.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/16.d28c56a9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/17.098395ed.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/18.bc634dc6.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/19.1845bec7.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/20.d107c76b.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/21.0dc7a8b0.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/22.80842d5f.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/23.d720acec.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/24.284e4246.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/25.67c9e135.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/26.b6508801.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/27.84732078.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/28.ad4e2160.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/29.bbfd091e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/3.3eb1b8be.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/30.0ab31ac3.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/31.a7bbc554.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/32.69380177.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/33.364ffb0d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/36.e98cc8a8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/37.3e6d2bb9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/38.51f7d952.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/39.6657e4df.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/4.b0b44883.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/40.07d8b206.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/41.ec985641.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/42.da65feb7.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/43.330ad3c9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/44.2355b352.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/45.ba08d784.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/46.b78a4275.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/47.c756152f.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/48.c42d9832.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/49.88d244ad.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/5.6e26806a.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/50.1a8b3116.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/51.82b4b7c9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/52.6c7a84fc.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/53.54cfc776.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/54.b88653b2.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/55.8eb80e3d.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/56.7097d49c.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/57.f36d4c29.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/58.99256047.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/59.ce9d9bd9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/6.33ab76f3.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/60.94d846d4.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/61.d94b8cf0.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/62.42da86d6.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/63.acf645d3.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/64.04e4e46f.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/65.027d53b0.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/66.7c6a4b84.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/67.4a8e6a48.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/68.2fb45341.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/69.211e34e2.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/7.77e5cd7e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/70.d260b2c6.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/71.c1d449e1.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/72.d8579221.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/73.36783afb.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/74.1153775a.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/75.7178c973.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/76.1e35b783.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/77.2589f8a5.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/78.b0fb34cd.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/79.ef753dea.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/8.ce2e5257.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/80.eaaee2ec.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/81.61ca7dc8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/82.43e64cec.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/83.7696a4c5.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/84.9caf1161.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/85.6fbd6ba8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/86.69a754a8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/87.367c2636.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/88.58f2fc2f.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/89.9d054267.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/9.686bf3d9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/90.81c6e1b0.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/91.85996cd8.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/92.879e44f2.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/93.c9244990.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/94.047f2491.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/95.208cbcef.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/96.e82bb3b9.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/97.d3f65d2e.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/98.581f6d36.js"><link rel="prefetch" href="/mysql-tutorial/assets/js/99.6f9c5b8b.js">
    <link rel="stylesheet" href="/mysql-tutorial/assets/css/0.styles.bc63ebf5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mysql-tutorial/" class="home-link router-link-active"><!----> <span class="site-name">MySQL 系列教程（笔记）</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mysql-tutorial/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="给程序员的 MySQL 8 必知必会" class="dropdown-title"><span class="title">给程序员的 MySQL 8 必知必会</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/" class="nav-link">
  导览
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/01.html" class="nav-link">
  课程序言
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/02/" class="nav-link">
  技术选型之数据库选型
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/03/" class="nav-link">
  数据库设计
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/04/" class="nav-link">
  如何访问 MySQL
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/05/" class="nav-link">
  日常工作 DCL、DDL
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/06/" class="nav-link">
  高阶技能：DML &amp; 常用函数
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/07/" class="nav-link">
  SQL 优化
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/08/" class="nav-link">
  SQL 的索引优化
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/09/" class="nav-link">
  事务与并发控制
</a></li></ul></div></div><div class="nav-item"><a href="/mysql-tutorial/ali-new-retail/" class="nav-link router-link-active">
  阿里新零售数据库设计与实战
</a></div><div class="nav-item"><a href="/mysql-tutorial/high-performance/" class="nav-link">
  高性能 MySQL（第 3 版）
</a></div><div class="nav-item"><a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  笔记精选汇总
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/zq99299/mysql-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mysql-tutorial/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="给程序员的 MySQL 8 必知必会" class="dropdown-title"><span class="title">给程序员的 MySQL 8 必知必会</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/" class="nav-link">
  导览
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/01.html" class="nav-link">
  课程序言
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/02/" class="nav-link">
  技术选型之数据库选型
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/03/" class="nav-link">
  数据库设计
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/04/" class="nav-link">
  如何访问 MySQL
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/05/" class="nav-link">
  日常工作 DCL、DDL
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/06/" class="nav-link">
  高阶技能：DML &amp; 常用函数
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/07/" class="nav-link">
  SQL 优化
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/08/" class="nav-link">
  SQL 的索引优化
</a></li><li class="dropdown-item"><!----> <a href="/mysql-tutorial/imooc-mysql8/09/" class="nav-link">
  事务与并发控制
</a></li></ul></div></div><div class="nav-item"><a href="/mysql-tutorial/ali-new-retail/" class="nav-link router-link-active">
  阿里新零售数据库设计与实战
</a></div><div class="nav-item"><a href="/mysql-tutorial/high-performance/" class="nav-link">
  高性能 MySQL（第 3 版）
</a></div><div class="nav-item"><a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  笔记精选汇总
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/zq99299/mysql-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/mysql-tutorial/ali-new-retail/" class="sidebar-link">阿里新零售数据库设计与实战</a></li><li><a href="/mysql-tutorial/ali-new-retail/01/" class="sidebar-link">开门见山</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前置准备</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前导知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>新零售数据结构设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常见问题与企业级解决方案-初级</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常见问题与企业级解决方案-进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常见问题与企业级解决方案-高阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>新零售系统数据库性能调优</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>新零售平台的数据库集群</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分库分表的 N 种姿势</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/mysql-tutorial/ali-new-retail/11/" class="sidebar-link">集群环境下的新零售数据库与总结</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>升级内容</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql-tutorial/ali-new-retail/12/" class="sidebar-link">新零售数据库在双十一不 down 机的秘诀？</a></li><li><a href="/mysql-tutorial/ali-new-retail/12/01.html" class="active sidebar-link">MyCat 双机热备方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#配置虚拟-ip-的前提条件" class="sidebar-link">配置虚拟 IP 的前提条件</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#正确设置虚拟-ip-的环境" class="sidebar-link">正确设置虚拟 IP 的环境</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#keepalived-工作原理" class="sidebar-link">Keepalived 工作原理</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#让防火墙支持-vrrp-协议" class="sidebar-link">让防火墙支持 VRRP 协议</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#虚拟-ip-地址" class="sidebar-link">虚拟 IP 地址</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#安装-keepalived" class="sidebar-link">安装 Keepalived</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#keepalived-配置文件" class="sidebar-link">keepalived 配置文件</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#搭建另外一个-mycat-容器" class="sidebar-link">搭建另外一个 MyCat 容器</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#测试双机热备" class="sidebar-link">测试双机热备</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#如何访问虚拟-ip" class="sidebar-link">如何访问虚拟 IP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#第一个虚拟机-keepalived-安装配置" class="sidebar-link">第一个虚拟机 Keepalived 安装配置</a></li><li class="sidebar-sub-header"><a href="/mysql-tutorial/ali-new-retail/12/01.html#第二个虚拟机-keepalived-安装配置" class="sidebar-link">第二个虚拟机 Keepalived 安装配置</a></li></ul></li></ul></li><li><a href="/mysql-tutorial/ali-new-retail/12/02.html" class="sidebar-link">使用 Portainer 管理 Docker</a></li><li><a href="/mysql-tutorial/ali-new-retail/12/03.html" class="sidebar-link">Binlog 日志文件的重要性</a></li><li><a href="/mysql-tutorial/ali-new-retail/12/04.html" class="sidebar-link">主从同步原理</a></li><li><a href="/mysql-tutorial/ali-new-retail/12/05.html" class="sidebar-link">高可用 Replication 集群</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mycat-双机热备方案"><a href="#mycat-双机热备方案" class="header-anchor">#</a> MyCat 双机热备方案</h1> <p>只有双机热备的 MyCat 方案才具备高可用性。</p> <p><img src="/mysql-tutorial/assets/img/image-20200621211931122.1a5c5c14.png" alt="image-20200621211931122"></p> <p>Keepalived 会去抢占虚拟 IP：</p> <ul><li>抢占到的成为 Master 节点，同时还会发出广播</li> <li>Backup 节点接收到广播，表示 Master 还活着</li> <li>当 Backup 节点接收不到广播的时候，表示 Master 宕机了，开始抢占节点</li></ul> <h2 id="配置虚拟-ip-的前提条件"><a href="#配置虚拟-ip-的前提条件" class="header-anchor">#</a> 配置虚拟 IP 的前提条件</h2> <ul><li><p>虚拟 IP 只支持局域网，不可以在公网设置虚拟 IP</p></li> <li><p>云主机无法设置虚拟 IP</p></li> <li><p><strong>只有 Linux 才可以设置虚拟 IP</strong></p> <p>windows 和 MacOS 系统无法设置</p></li> <li><p>公司网络与移动热点网络环境下，不能设置虚拟 IP</p></li></ul> <h2 id="正确设置虚拟-ip-的环境"><a href="#正确设置虚拟-ip-的环境" class="header-anchor">#</a> 正确设置虚拟 IP 的环境</h2> <ul><li>在 VM 虚拟机上面设置桥接网络（必须）</li> <li>使用家用路由器的网络环境（链接网线最好，WIFI 其次）</li></ul> <h2 id="keepalived-工作原理"><a href="#keepalived-工作原理" class="header-anchor">#</a> Keepalived 工作原理</h2> <p>Keepalived 基于 VRRP 协议，可以预防单点故障。</p> <p>VRRP 协议将多个服务节点组成一个网络，里面有一个 Master 和 若干 Backup 节点。</p> <p>Master 会发送 VRRP 广播，如果 Backup 节点收不到广播，就认为 Master 节点宕机了。Backup 节点会选举出一个新的 Master 节点，这个选举过程，我们可以进行一定的干预，比如哪些节点优先级高一点，成为 master 的可能性就大一点。</p> <h2 id="让防火墙支持-vrrp-协议"><a href="#让防火墙支持-vrrp-协议" class="header-anchor">#</a> 让防火墙支持 VRRP 协议</h2> <p>开放防火墙，让 CentOS 支持 VRRP 协议</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT <span class="token number">0</span> 
--in-interface ens33				<span class="token comment"># 网卡名称</span>
--destination <span class="token number">224.0</span>.0.18		<span class="token comment"># 广播地址，VRRP 协议固定的，不用修改</span>
--protocol vrrp -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>实际操作练习：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study volumes<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 0 --in-interface enp0s8 --destination 224.0.0.18 --protocol vrrp -j ACCEPT</span>
<span class="token punctuation">[</span>root@study volumes<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --reload</span>

<span class="token comment"># 记得还是需要重启 docker 服务</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="虚拟-ip-地址"><a href="#虚拟-ip-地址" class="header-anchor">#</a> 虚拟 IP 地址</h2> <p>在 Linux 系统中可以在网卡设备中设置多个 IP 地址，已达到为不同程序分配一个独立的 IP 地址，这种 IP 地址被称作虚拟 IP</p> <p><img src="/mysql-tutorial/assets/img/image-20200621213655845.c81761af.png" alt="image-20200621213655845"></p> <h2 id="安装-keepalived"><a href="#安装-keepalived" class="header-anchor">#</a> 安装 Keepalived</h2> <p>进入到 MyCat 容器</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 该容器是基于 乌班图 的，软件管理就是用的 apt-get</span>
<span class="token comment"># 先更新下</span>
<span class="token punctuation">[</span>root@study volumes<span class="token punctuation">]</span><span class="token comment"># docker exec -it mycat1 bash</span>
root@study:/<span class="token comment"># apt-get update</span>
root@study:/<span class="token comment"># apt-get install keepalived</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="keepalived-配置文件"><a href="#keepalived-配置文件" class="header-anchor">#</a> keepalived 配置文件</h2> <p>keepalived 的配置文件路径是 <code>/etc/keepalived/keepalived.conf</code>，配置文件内容为</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vrrp_instance VI_1 <span class="token punctuation">{</span>
	state MASTER
	interface docker_gwbridge
	virtual_router_id <span class="token number">51</span>
	priority <span class="token number">100</span>
	advert_int <span class="token number">1</span>
	authentication <span class="token punctuation">{</span>
		auth_type PASS
		auth_pass <span class="token number">123456</span>
	<span class="token punctuation">}</span>
	virtual_ipaddress <span class="token punctuation">{</span>
		<span class="token number">172.18</span>.0.201
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><p>state：Keepalived 的身份</p> <p>MASTER 主服务，BACKUP 备服务。主服务要抢占虚拟 IP，备用服务不会抢占 IP。</p> <p>所以要在诶个 Keepalived 中设置为 MASTER 他们才会抢占 IP</p></li> <li><p>interface：网卡设备</p> <p>这里绑定的是 <strong>docker 容器里的网卡设备</strong></p></li> <li><p>virtual_router_id：虚拟路由 ID 名字</p> <p>相同的虚拟路由 ID 才能被编入一组 vrrp 网络中。也就是说类似分组组网的功能。</p></li> <li><p>priority：权重</p> <p>数值越大，越可能被选举为 Master 节点；</p> <p>你可以把硬件配置比较好的节点权重设置高一点</p></li> <li><p>advert_int：心跳时间</p> <p>MASTER 与 BACKUP 节点之间同步检查的时间间隔，单位为秒。<strong>主备之间必须一致</strong></p> <p>超过该值，MASTER 还没有发送广播，那么 BACKUP 节点就会重新选举 MASTER 了</p></li> <li><p>authentication：主从服务器验证方式</p> <p><strong>主备必须使用相同</strong> 的密码才能正常通信</p></li> <li><p>virtual_ipaddress：虚拟 IP 地址</p> <p>容器是运行在 swarm 网络里面的，所以该地址要设置为 swarm 里面的 IP 地址；</p> <p>swarm 网段为 172.18.0.x</p></li></ul> <p>由于我们直接安装的，该程序并没有安装到我们的数据卷中，所以要先给 docker 容器安装 vim 程序，然后使用 vim 程序来编写配置文件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@study:/<span class="token comment"># apt-get install vim -y</span>
root@study:/<span class="token comment"># vim /etc/keepalived/keepalived.conf</span>
<span class="token comment"># 配置内容如下</span>
vrrp_instance VI_1 <span class="token punctuation">{</span>
	state MASTER
	interface docker_gwbridge
	virtual_router_id <span class="token number">51</span>
	priority <span class="token number">100</span>
	advert_int <span class="token number">1</span>
	authentication <span class="token punctuation">{</span>
		auth_type PASS
		auth_pass <span class="token number">123456</span>
	<span class="token punctuation">}</span>
	virtual_ipaddress <span class="token punctuation">{</span>
		<span class="token number">172.18</span>.0.201
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>启动 keepalived</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@study:/<span class="token comment"># service keepalived start</span>
 * Starting keepalived keepalived                 <span class="token punctuation">[</span> OK <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>检查是否配置成功</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 回到宿主机中，pin 虚拟 IP</span>
<span class="token punctuation">[</span>root@study volumes<span class="token punctuation">]</span><span class="token comment"># ping 172.18.0.201</span>
PING <span class="token number">172.18</span>.0.201 <span class="token punctuation">(</span><span class="token number">172.18</span>.0.201<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">172.18</span>.0.201: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.045</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.18</span>.0.201: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.041</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.18</span>.0.201: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.045</span> ms
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="搭建另外一个-mycat-容器"><a href="#搭建另外一个-mycat-容器" class="header-anchor">#</a> 搭建另外一个 MyCat 容器</h2> <p><img src="/mysql-tutorial/assets/img/image-20200621211931122.1a5c5c14.png" alt="image-20200621211931122"></p> <p>双机热备 MyCat 方案由于需要两个 MyCat 容器，所以还需要挑选一台宿主机去安装 MyCat 容器，并且安装好 Keepalived</p> <p>这里说些安装步骤：</p> <ol><li>先配置 Keepalived VRRP 防火墙协议</li> <li>重启 docker 服务</li> <li>然后创建 MyCat 容器</li> <li>把第一个 MyCat 容器数据卷中的 MyCat 文件复制一份到第二个 Mycat 容器中</li></ol> <p>笔者这里使用 192.168.56.107 这台虚拟机实例来安装；</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 0 --in-interface enp0s8 --destination 224.0.0.18 --protocol vrrp -j </span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --reload</span>

<span class="token comment"># 重启 docker 服务</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span>

<span class="token comment"># 恢复启动原来的数据源集群容器</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># docker start rn5</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># docker start rn2</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># docker start pn5</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># docker start pn2</span>

<span class="token comment"># 创建 MyCat 容器</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -it --name mycat2 -v mycat2:/root/server --privileged --net=host openjdk8</span>
<span class="token comment"># 进入到该容器数据卷中</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># docker volume inspect mycat2</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> null,
        <span class="token string">&quot;Mountpoint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/mycat2/_data&quot;</span>,
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;mycat2&quot;</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># cd /var/lib/docker/volumes/mycat2/_data</span>

<span class="token comment"># 在 mycat1 容器上，通过 ssh 复制 mycat 目录到该数据卷下</span>
<span class="token punctuation">[</span>root@study _data<span class="token punctuation">]</span><span class="token comment"># scp -r mycat/ root@192.168.56.107:/var/lib/docker/volumes/mycat2/_data</span>

<span class="token comment"># 回到 mycat2 容器上，并进入容器，启动 mycat</span>
<span class="token punctuation">[</span>root@study _data<span class="token punctuation">]</span><span class="token comment"># docker exec -it mycat2 bash</span>
root@study:/<span class="token comment"># cd /root/server/mycat/bin/</span>
root@study:~/server/mycat/bin<span class="token comment"># ./startup_nowrap.sh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>第二个 MyCat 容器也安装好了。需要通过 Navicat 验证下 mycat2 是否可以使用；</p> <p>安装并配置 Keepalived</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@study:/<span class="token comment"># apt-get update</span>
root@study:/<span class="token comment"># apt-get install keepalived -y</span>
root@study:/<span class="token comment"># apt-get install vim -y</span>
root@study:/<span class="token comment"># vim /etc/keepalived/keepalived.conf</span>
<span class="token comment"># 配置内容如下</span>
vrrp_instance VI_1 <span class="token punctuation">{</span>
	state MASTER
	interface docker_gwbridge
	virtual_router_id <span class="token number">51</span>
	priority <span class="token number">100</span>
	advert_int <span class="token number">1</span>
	authentication <span class="token punctuation">{</span>
		auth_type PASS
		auth_pass <span class="token number">123456</span>
	<span class="token punctuation">}</span>
	virtual_ipaddress <span class="token punctuation">{</span>
		<span class="token number">172.18</span>.0.201
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
root@study:/<span class="token comment"># service keepalived start</span>
 * Starting keepalived keepalived                 <span class="token punctuation">[</span> OK <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="测试双机热备"><a href="#测试双机热备" class="header-anchor">#</a> 测试双机热备</h2> <p>两个 MyCat 容器和 Keepalived 都安装配置启动后，可以使用如下的方式来测试，是否有效</p> <ol><li>随意停掉一个 mycat 容器</li> <li>再 <code>ping 172.18.0.201</code> 是否能 ping 通</li> <li>再停掉一个 mycat 容器</li> <li>再 <code>ping 172.18.0.201</code> 是否能 ping 通</li></ol> <p>尴尬的是，笔者这里关完都能访问.</p> <h2 id="如何访问虚拟-ip"><a href="#如何访问虚拟-ip" class="header-anchor">#</a> 如何访问虚拟 IP</h2> <p>现在在宿主机上可以访问虚拟 IP（因为有 docker_gwbridge 的原因），在非虚拟机上如何访问到虚拟机中的虚拟 IP？</p> <p>Swarm 网络内的虚拟 IP 无法被外网访问，所以需要把虚拟 IP 映射到外网：</p> <p><img src="/mysql-tutorial/assets/img/image-20200621225537824.a1a27dd6.png" alt="image-20200621225537824"></p> <p>原理就如上：要在宿主机中安装 Keepalived，也可以把 2 台宿主机做成一个主备 Keepalived 方案，达成宿主机的高可用</p> <h3 id="第一个虚拟机-keepalived-安装配置"><a href="#第一个虚拟机-keepalived-安装配置" class="header-anchor">#</a> 第一个虚拟机 Keepalived 安装配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># yum install keepalived -y</span>

<span class="token comment"># 该文件中有一些默认内容，可以全部删除</span>
<span class="token punctuation">[</span>root@study ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/keepalived/keepalived.conf</span>
<span class="token comment"># 配置内容如下</span>
vrrp_instance VI_1 <span class="token punctuation">{</span>
	state MASTER
	interface enp0s8			<span class="token comment"># 宿主机的网卡</span>
	virtual_router_id <span class="token number">61</span>
	priority <span class="token number">100</span>
	advert_int <span class="token number">1</span>
	authentication <span class="token punctuation">{</span>
		auth_type PASS
		auth_pass <span class="token number">1111</span>
	<span class="token punctuation">}</span>
	virtual_ipaddress <span class="token punctuation">{</span>
		<span class="token number">192.168</span>.56.200		<span class="token comment"># 局域网中一个没有被使用的 IP 作为虚拟 IP</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

virtual_server <span class="token number">192.168</span>.56.105 <span class="token number">8066</span><span class="token punctuation">{</span>
	delay_loop <span class="token number">3</span>
	lb_algo rr
	lb_kind NAT
	persistence <span class="token function">timeout</span> <span class="token number">50</span>
	protocol TCP
	real_server <span class="token number">172.18</span>.0.201 <span class="token number">8066</span><span class="token punctuation">{</span>
	  weight <span class="token number">1</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

virtual_server <span class="token number">192.168</span>.56.105 <span class="token number">9066</span><span class="token punctuation">{</span>
	delay_loop <span class="token number">3</span>
	lb_algo rr
	lb_kind NAT
	persistence <span class="token function">timeout</span> <span class="token number">50</span>
	protocol TCP
	real_server <span class="token number">172.18</span>.0.201 <span class="token number">9066</span><span class="token punctuation">{</span>
	  weight <span class="token number">1</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><ul><li>delay_loop：心跳检测，单位秒</li> <li>lb_algo： rr 为轮询模式</li> <li>lb_kind： NAT 为 NAT 模式</li> <li>persistence timeout：超时</li> <li>real_server：虚拟 IP 接收到请求之后，转发的 IP；该参数很重要</li></ul> <p>启动 Keepalived</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@study mycat<span class="token punctuation">]</span><span class="token comment"># service keepalived start</span>
Redirecting to /bin/systemctl start keepalived.service

<span class="token comment"># pin 这个虚拟 IP 是否可用</span>
<span class="token punctuation">[</span>root@study mycat<span class="token punctuation">]</span><span class="token comment"># ping 192.168.56.200</span>
PING <span class="token number">192.168</span>.56.200 <span class="token punctuation">(</span><span class="token number">192.168</span>.56.200<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.56.200: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.051</span> ms
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.56.200: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.044</span> ms
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.56.200: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.044</span> ms
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.56.200: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.059</span> ms
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>通过 Navicat 链接：</p> <ul><li>ip：192.168.56.200</li> <li>端口：8066</li></ul> <p>前面说到 mycat 容器都关掉了，虚拟 IP 还是可以 ping  通，但是访问不到 mycat 服务。笔者重启了 mycat1 容器包括里面的 mycat 和 Keepalived 服务后，就可以通过 Navicat 链接到虚拟机宿主机上的虚拟 IP 了；</p> <h3 id="第二个虚拟机-keepalived-安装配置"><a href="#第二个虚拟机-keepalived-安装配置" class="header-anchor">#</a> 第二个虚拟机 Keepalived 安装配置</h3> <p>那么还需要配置第二个虚拟机宿主机上的 Keepalived 程序。配置文件和上面的一样。有一点点不一样， 这里转发的 IP 是自己的 docker 容器上的 IP</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vrrp_instance VI_1 <span class="token punctuation">{</span>
	state MASTER
	interface enp0s8			<span class="token comment"># 宿主机的网卡</span>
	virtual_router_id <span class="token number">61</span>
	priority <span class="token number">100</span>
	advert_int <span class="token number">1</span>
	authentication <span class="token punctuation">{</span>
		auth_type PASS
		auth_pass <span class="token number">1111</span>
	<span class="token punctuation">}</span>
	virtual_ipaddress <span class="token punctuation">{</span>
		<span class="token number">192.168</span>.56.200		<span class="token comment"># 局域网中一个没有被使用的 IP 作为虚拟 IP</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 这里转发的 IP 是自己的 docker 容器上的 IP</span>
virtual_server <span class="token number">192.168</span>.56.107 <span class="token number">8066</span><span class="token punctuation">{</span>
	delay_loop <span class="token number">3</span>
	lb_algo rr
	lb_kind NAT
	persistence <span class="token function">timeout</span> <span class="token number">50</span>
	protocol TCP
	real_server <span class="token number">172.18</span>.0.201 <span class="token number">8066</span><span class="token punctuation">{</span>
	  weight <span class="token number">1</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

virtual_server <span class="token number">192.168</span>.56.107 <span class="token number">9066</span><span class="token punctuation">{</span>
	delay_loop <span class="token number">3</span>
	lb_algo rr
	lb_kind NAT
	persistence <span class="token function">timeout</span> <span class="token number">50</span>
	protocol TCP
	real_server <span class="token number">172.18</span>.0.201 <span class="token number">9066</span><span class="token punctuation">{</span>
	  weight <span class="token number">1</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>测试方案，和第一个里面的类似。把 Mycat1 容器关掉，看看还能不能访问到 mycat 呢？笔者测试是可以的</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zq99299/mysql-tutorial/edit/master/docs/ali-new-retail/12/01.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: :</span> <span class="time">6 days ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mysql-tutorial/ali-new-retail/12/" class="prev router-link-active">
        新零售数据库在双十一不 down 机的秘诀？
      </a></span> <span class="next"><a href="/mysql-tutorial/ali-new-retail/12/02.html">
        使用 Portainer 管理 Docker
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/mysql-tutorial/assets/js/app.7ac7a46f.js" defer></script><script src="/mysql-tutorial/assets/js/2.ea6cbf3c.js" defer></script><script src="/mysql-tutorial/assets/js/34.07624a4c.js" defer></script><script src="/mysql-tutorial/assets/js/35.02d8d681.js" defer></script>
  </body>
</html>
