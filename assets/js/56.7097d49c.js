(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{422:function(s,t,a){s.exports=a.p+"assets/img/image-20200607203427729.80a344d0.png"},661:function(s,t,a){"use strict";a.r(t);var n=a(15),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"千万记录，如何快速分页"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#千万记录，如何快速分页"}},[s._v("#")]),s._v(" 千万记录，如何快速分页")]),s._v(" "),n("p",[s._v("首先先来看下面几个语句的查询时间")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("那么先创建测试数据表和测试数据")]),s._v(" "),n("p",[s._v("创建测试表")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t_test\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    id     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("插入测试数据")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[s._v(" "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fun2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BufferedWriter")]),s._v(" writer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Files")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("newBufferedWriter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/Users/mrcode/Desktop/test.sql"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// writer.append("insert into t_test(id,`name`) values (" + i + ",\'" + UUID.randomUUID().toString() + "\');\\n");')]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这是利用工具导入，只输出列值")]),s._v("\n              writer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" UUID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomUUID")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("编写了一个产生 1000 万行的随机数据，通过工具导入；笔者测试过以下两种方式：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("生成 insert into 语句，通过 navicat 执行 sql 文件导入")]),s._v(" "),n("p",[s._v("耗时 30 分钟，结果还把数据库搞死了。")]),s._v(" "),n("p",[s._v("原因是：使用这种方式是带事务执行的，特别慢")])]),s._v(" "),n("li",[n("p",[s._v("生成数据，用 DataGrip 导入")]),s._v(" "),n("p",[s._v("只用了 4 分钟。这种方式是不带事务的带入。")])])]),s._v(" "),n("p",[s._v("看看查询时间信息")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("neti"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" retrieved "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("starting")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("execution: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fetching: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nneti"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" retrieved "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("starting")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("execution: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fetching: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nneti"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" retrieved "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("starting")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("362")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("execution: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("336")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fetching: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nneti"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" retrieved "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("starting")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("244")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("execution: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fetching: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nneti"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" retrieved "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("starting")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("247")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("execution: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("221")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fetching: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("越往后，时间越长")]),s._v(" "),n("h2",{attrs:{id:"优化办法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化办法"}},[s._v("#")]),s._v(" 优化办法")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("利用主键索引来加速分页查询；（前提：主键连续）")]),s._v(" "),n("p",[s._v("写法一：")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("neti"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000000")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" retrieved "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("starting")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("execution: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fetching: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("可以看到值用了 60 毫秒；")]),s._v(" "),n("p",[s._v("写法二：")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("neti"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000000")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" retrieved "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("starting")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("execution: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fetching: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("这个耗时更少。")])]),s._v(" "),n("li",[n("p",[s._v("如果主键值不连续，怎么分页？")]),s._v(" "),n("ul",[n("li",[s._v("使用逻辑删除，不会造成主键不连续")]),s._v(" "),n("li",[s._v("利用主键索引加速，再做表连接查询")])]),s._v(" "),n("p",[s._v("下面是这个方案的写法")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("neti"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test t\n               "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_test "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" tmp "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tmp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" retrieved "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("starting")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("956")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("execution: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("935")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fetching: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" ms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("这个语句是想用子查询先利用 "),n("strong",[s._v("主键索引")]),s._v(" 过滤出 100 条数据，再关联出这 100 条的数据。不过这个语句在执行计划里面并不是我们希望的这样去查询的。")]),s._v(" "),n("p",[s._v("虽然是这样，但是比 limit 还是要快上几百毫秒")])]),s._v(" "),n("li",[n("p",[s._v("其他解决办法")]),s._v(" "),n("p",[s._v("业务上限定不可以查询早期数据，或则不给出直接跳到多少条之后的入口")]),s._v(" "),n("p",[n("img",{attrs:{src:a(422),alt:"image-20200607203427729"}})])])])])}),[],!1,null,null,null);t.default=e.exports}}]);