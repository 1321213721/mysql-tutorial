(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{491:function(t,a,s){t.exports=s.p+"assets/img/image-20200621181612366.a0be7f53.png"},492:function(t,a,s){t.exports=s.p+"assets/img/image-20200621181834358.5bf651e9.png"},493:function(t,a,s){t.exports=s.p+"assets/img/image-20200621182420663.0c7d2ba7.png"},494:function(t,a,s){t.exports=s.p+"assets/img/image-20200621182700872.c07f36f6.png"},495:function(t,a,s){t.exports=s.p+"assets/img/image-20200621182853195.d66abfa5.png"},496:function(t,a,s){t.exports=s.p+"assets/img/image-20200621183014367.b0957913.png"},497:function(t,a,s){t.exports=s.p+"assets/img/image-20200621183126068.d5ed5993.png"},498:function(t,a,s){t.exports=s.p+"assets/img/image-20200621183333572.a5ee52cc.png"},499:function(t,a,s){t.exports=s.p+"assets/img/image-20200621184056678.1c5b8816.png"},672:function(t,a,s){"use strict";s.r(a);var e=s(15),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"集群环境下的新零售数据库与总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#集群环境下的新零售数据库与总结"}},[t._v("#")]),t._v(" 集群环境下的新零售数据库与总结")]),t._v(" "),e("p",[t._v("本章也探讨下如何将新零售数据库迁移到集群环境中。")]),t._v(" "),e("h2",{attrs:{id:"迁移新零售数据库到集群环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#迁移新零售数据库到集群环境"}},[t._v("#")]),t._v(" 迁移新零售数据库到集群环境")]),t._v(" "),e("p",[t._v("如果是 "),e("strong",[t._v("小型的新零售业务")]),t._v("，可以只 "),e("strong",[t._v("选择水平切分")]),t._v("。如果是 "),e("strong",[t._v("大中型的新零售业务")]),t._v("，可以兼顾 "),e("strong",[t._v("垂直切分和水平切分")])]),t._v(" "),e("p",[t._v("本课是按照大型系统进行数据库设计的方案，"),e("strong",[t._v("先按照业务划分出若干的子系统")]),t._v("，再去设计这些 "),e("strong",[t._v("子系统应该使用什么样的数据库集群")])]),t._v(" "),e("h3",{attrs:{id:"垂直切分方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#垂直切分方案"}},[t._v("#")]),t._v(" 垂直切分方案")]),t._v(" "),e("p",[e("img",{attrs:{src:s(491),alt:"image-20200621181612366"}})]),t._v(" "),e("p",[t._v("拆分成 5 个子系统：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("企业系统：企业管理系统，")]),t._v(" "),e("p",[t._v("管理员工、部门、角色、权限、财务等")])]),t._v(" "),e("li",[e("p",[t._v("销售系统：线上线下的销售")]),t._v(" "),e("p",[t._v("商品表、订单表等")])]),t._v(" "),e("li",[e("p",[t._v("售后系统：")]),t._v(" "),e("p",[t._v("购物评价、退换货等")])]),t._v(" "),e("li",[e("p",[t._v("仓库系统：管理进销存的信息")])]),t._v(" "),e("li",[e("p",[t._v("物流系统：快递信息跟踪由该系统支持")])])]),t._v(" "),e("p",[t._v("对于垂直切分，没有固定的答案，和业务规模、团队技术等相关，每个人的理解都不太一样。")]),t._v(" "),e("h3",{attrs:{id:"创建逻辑库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建逻辑库"}},[t._v("#")]),t._v(" 创建逻辑库")]),t._v(" "),e("p",[t._v("以售后系统举例：由于售后系统的数据价值不是很高，使用 Replication 集群来保存数据。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(492),alt:"image-20200621181834358"}})]),t._v(" "),e("h3",{attrs:{id:"映射逻辑库分片关系"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#映射逻辑库分片关系"}},[t._v("#")]),t._v(" 映射逻辑库分片关系")]),t._v(" "),e("div",{staticClass:"language-xml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-xml"}},[e("code",[t._v(" "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dataNode")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("iass1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataHost")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("rep1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("database")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("iass"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dataNode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dataNode")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("iass2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataHost")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("rep2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("database")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("iass"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dataNode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("p",[t._v("使用两个集群分片来存储。")]),t._v(" "),e("h3",{attrs:{id:"数据库集群方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#数据库集群方案"}},[t._v("#")]),t._v(" 数据库集群方案")]),t._v(" "),e("p",[t._v("什么样的子系统适合用什么样的方案，可以参考下下面的表格")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("序号")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("系统名称")]),t._v(" "),e("th",[t._v("集群方案")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("1")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("企业系统")]),t._v(" "),e("td",[t._v("Replication")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("2")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("销售系统")]),t._v(" "),e("td",[t._v("PXC、Replication")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("3")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("售后系统")]),t._v(" "),e("td",[t._v("Replication")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("4")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("仓库系统")]),t._v(" "),e("td",[t._v("Replication")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("5")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("物流系统")]),t._v(" "),e("td",[t._v("Replication")])])])]),t._v(" "),e("ul",[e("li",[e("p",[t._v("企业系统的数据库集群配置")]),t._v(" "),e("p",[t._v("企业系统的 "),e("strong",[t._v("数据量和访问量并不是很大")]),t._v("，用一个 Replication 分片，然后 "),e("strong",[t._v("都设置成全局表")]),t._v(" 即可")]),t._v(" "),e("p",[e("img",{attrs:{src:s(493),alt:"image-20200621182420663"}})]),t._v(" "),e("p",[t._v("最好配置两个主节点，这个知识点在后续的升级中讲解")])]),t._v(" "),e("li",[e("p",[t._v("销售系统的数据库集群配置")]),t._v(" "),e("p",[t._v("销售系统中 **重要的数据 **需要切分存 "),e("strong",[t._v("储到 PXC 分片")]),t._v("，非重要的切分存储在 Replication 分片。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(494),alt:"image-20200621182700872"}})]),t._v(" "),e("p",[t._v("对于分片的规模，需要看具体的数据规模、还需要做好冷热数据的归档，冷数据抽到 TokuDB 或 MongoDB 中")])]),t._v(" "),e("li",[e("p",[t._v("售后系统的数据库集群配置")]),t._v(" "),e("p",[t._v("大多数的数据是 "),e("strong",[t._v("数据量大的低价值的")]),t._v(" 数据，所以可以采用 Replication 切分存储；")]),t._v(" "),e("p",[e("img",{attrs:{src:s(495),alt:"image-20200621182853195"}})])]),t._v(" "),e("li",[e("p",[t._v("仓库系统的数据库集群配置")]),t._v(" "),e("p",[t._v("仓库系统 "),e("strong",[t._v("数据相对较少")]),t._v("，所以 "),e("strong",[t._v("可以不使用水平切分")]),t._v("，仅 "),e("strong",[t._v("使用一个 Replication 分片")]),t._v("，数据表都 "),e("strong",[t._v("设计成全局表")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(496),alt:"image-20200621183014367"}})])]),t._v(" "),e("li",[e("p",[t._v("物流系统的数据库集群配置")]),t._v(" "),e("p",[t._v("数据相对较多，可以采用 Replication 切分存储。")]),t._v(" "),e("p",[t._v("如快递已发出、到了转运地区，等一个包裹的物流数据就好多条；")]),t._v(" "),e("p",[e("img",{attrs:{src:s(497),alt:"image-20200621183126068"}})])])]),t._v(" "),e("h2",{attrs:{id:"课程总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#课程总结"}},[t._v("#")]),t._v(" 课程总结")]),t._v(" "),e("p",[t._v("拓宽了数据库的技术视野")]),t._v(" "),e("p",[e("img",{attrs:{src:s(498),alt:"image-20200621183333572"}})]),t._v(" "),e("p",[t._v("这里笔者就不记录回顾讲解了哪些细致的知识点了。")]),t._v(" "),e("p",[t._v("对于数据库集群底层的原理，这里没有讲解。可以去搜该老师的 PXC 集群课程观看。这里我们使用了别人/官方封装好的 Docker 镜像快速搭建起数据库集群，对于里面需要修改哪些配置文件之类的，镜像封装了细节。")]),t._v(" "),e("h2",{attrs:{id:"后续课程升级内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#后续课程升级内容"}},[t._v("#")]),t._v(" 后续课程升级内容")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Docker 图形化界面")])]),t._v(" "),e("li",[e("p",[t._v("封装 Replication 镜像")])]),t._v(" "),e("li",[e("p",[t._v("分布式事务")])]),t._v(" "),e("li",[e("p",[t._v("ETL 中间件")]),t._v(" "),e("p",[t._v("经过垂直切分之后，无法做表连接查询，但是可以通过 ETL 中间件从多个数据源抽取相关数据")]),t._v(" "),e("p",[e("img",{attrs:{src:s(499),alt:"image-20200621184056678"}})]),t._v(" "),e("p",[t._v("写程序时，面对这个结果集查询。")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);